<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>国密学习笔记-SKF接口 | 行走的康康</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 6.1.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">国密学习笔记-SKF接口</h1><a id="logo" href="/.">行走的康康</a><p class="description">静下心来,不要浮躁</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">国密学习笔记-SKF接口</h1><div class="post-meta">2022-04-10<span> | </span><span class="category"><a href="/categories/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/">加密算法</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 10.7k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 44</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="post-content"><p>初次接触SKF接口–国密标准中智能密码钥匙的C语言应用开发接口标准，记录之。</p>
<span id="more"></span>

<h1 id="SKF接口简介"><a href="#SKF接口简介" class="headerlink" title="SKF接口简介"></a>SKF接口简介</h1><p>SKF接口是国密标准中智能密码钥匙的C语言应用开发接口标准，目前很多国内密码密码设备厂商都为其产品提供了SKF接口的开发包。开发者可以通过统一的SKF接口开发密码应用，访问来自不同设备供应商的USB-Key、TF卡、智能卡等不同形态的密码设备，而无需和某一个设备供应商的专属设备或专属接口绑定。</p>
<p>SKF是一个底层的密码设备应用开发接口，这个接口<strong>不支持数字证书和SSL通信</strong>等面向高层密码应用的功能，对于应用开发者来说直接使用SKF接口开发密码应用，工作量较大。</p>
<p>由于SKF的标准草案和正式公布标准在内容上有一些差异，导致<strong>不同设备厂商的SKF实现存在一些关键性的差异</strong>，这些差异导致应用开发者难以从一个设备供应商迁移至另一个设备供应商，更难以在同一个应用中同时支持来自两个厂商的设备，无法满足典型应用场景的需求。</p>
<h1 id="逻辑关系"><a href="#逻辑关系" class="headerlink" title="逻辑关系"></a>逻辑关系</h1><p>一个SKF API设备中可以包含一个或多个应用(Application)，每个应用可以包含一个获多个容器(Container)，每个容器中可以存放两对分别用于加密和签名的密钥对，以及两个相应的证书或证书链。每一个容器只能为ECC或RSA一种类型，一个容器中不能混用ECC密钥和RSA密钥。因此，在SKF API中提供公钥密码计算的接口通过Container Handle来引用公钥，容器的特性使得应用无需区分签名密钥和加密密钥，SKF API的实现会自动从容器中选择对应类型的密钥。</p>
<img src="https://nas.littlekang.xyz:9000/markdown/2022-04/0921_5225-F3AIzYuozIdXnKfl.png" alt="image-20220409215224956" style="zoom:200%;" />

 

 

<img src="https://nas.littlekang.xyz:9000/markdown/2022-04/0921_5057-9QFglD4CtrrFoI7Z.png" alt="image-20220409215057520" style="zoom:200%;" />

 

<img src="https://nas.littlekang.xyz:9000/markdown/2022-04/0921_5319-mqexacqz874Iaq9B.png" alt="image-20220409215319262" style="zoom:200%;" />

 

<h1 id="SKF-接口"><a href="#SKF-接口" class="headerlink" title="SKF 接口"></a>SKF 接口</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 根据国密局《智能IC卡及智能密码钥匙密码应用接口规范20091217厂商版》PDF文档整理而成。</span></span><br><span class="line"><span class="comment">* 2010.04.12</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _SKF_API_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _SKF_API_H_</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_OK                    0x00000000    <span class="comment">//成功</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_FAIL                0x0A000001    <span class="comment">//失败</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_UNKNOWNERR            0x0A000002    <span class="comment">//异常错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_NOTSUPPORTYETERR    0x0A000003    <span class="comment">//不支持的服务</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_FILEERR                0x0A000004    <span class="comment">//文件操作错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_INVALIDHANDLEERR    0x0A000005    <span class="comment">//无效的句柄</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_INVALIDPARAMERR        0x0A000006    <span class="comment">//无效的参数</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_READFILEERR            0x0A000007    <span class="comment">//读文件错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_WRITEFILEERR        0x0A000008    <span class="comment">//写文件错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_NAMELENERR            0x0A000009    <span class="comment">//名称长度错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_KEYUSAGEERR            0x0A00000A    <span class="comment">//密钥用途错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_MODULUSLENERR        0x0A00000B    <span class="comment">//模的长度错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_NOTINITIALIZEERR    0x0A00000C    <span class="comment">//未初始化</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_OBJERR                0x0A00000D    <span class="comment">//对象错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_MEMORYERR            0x0A00000E    <span class="comment">//内存错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_TIMEOUTERR            0x0A00000F    <span class="comment">//超时</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_INDATALENERR        0x0A000010    <span class="comment">//输入数据长度错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_INDATAERR            0x0A000011    <span class="comment">//输入数据错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_GENRANDERR            0x0A000012    <span class="comment">//生成随机数错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_HASHOBJERR            0x0A000013    <span class="comment">//HASH对象错</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_HASHERR                0x0A000014    <span class="comment">//HASH运算错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_GENRSAKEYERR        0x0A000015    <span class="comment">//产生RSA密钥错</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_RSAMODULUSLENERR    0x0A000016    <span class="comment">//RSA密钥模长错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_CSPIMPRTPUBKEYERR    0x0A000017    <span class="comment">//CSP服务导入公钥错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_RSAENCERR            0x0A000018    <span class="comment">//RSA加密错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_RSADECERR            0x0A000019    <span class="comment">//RSA解密错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_HASHNOTEQUALERR        0x0A00001A    <span class="comment">//HASH值不相等</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_KEYNOTFOUNTERR        0x0A00001B    <span class="comment">//密钥未发现</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_CERTNOTFOUNTERR        0x0A00001C    <span class="comment">//证书未发现</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_NOTEXPORTERR        0x0A00001D    <span class="comment">//对象未导出</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_DECRYPTPADERR        0x0A00001E    <span class="comment">//解密时做补丁错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_MACLENERR            0x0A00001F    <span class="comment">//MAC长度错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_BUFFER_TOO_SMALL    0x0A000020    <span class="comment">//缓冲区不足</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_KEYINFOTYPEERR        0x0A000021    <span class="comment">//密钥类型错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_NOT_EVENTERR        0x0A000022    <span class="comment">//无事件错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_DEVICE_REMOVED        0x0A000023    <span class="comment">//设备已移除</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_PIN_INCORRECT        0x0A000024    <span class="comment">//PIN不正确</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_PIN_LOCKED            0x0A000025    <span class="comment">//PIN被锁死</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_PIN_INVALID            0x0A000026    <span class="comment">//PIN无效</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_PIN_LEN_RANGE        0x0A000027    <span class="comment">//PIN长度错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_USER_ALREADY_LOGGED_IN        0x0A000028    <span class="comment">//用户已经登录</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_USER_PIN_NOT_INITIALIZED    0x0A000029    <span class="comment">//没有初始化用户口令</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_USER_TYPE_INVALID            0x0A00002A    <span class="comment">//PIN类型错误</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_APPLICATION_NAME_INVALID    0x0A00002B    <span class="comment">//应用名称无效</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_APPLICATION_EXISTS            0x0A00002C    <span class="comment">//应用已经存在</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_USER_NOT_LOGGED_IN            0x0A00002D    <span class="comment">//用户没有登录</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_APPLICATION_NOT_EXISTS        0x0A00002E    <span class="comment">//应用不存在</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_FILE_ALREADY_EXIST            0x0A00002F    <span class="comment">//文件已经存在</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_NO_ROOM                        0x0A000030    <span class="comment">//空间不足</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_FILE_NOT_EXIST                0x0A000031    <span class="comment">//文件不存在</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SAR_REACH_MAX_CONTAINER_COUNT    0x0A000032    <span class="comment">//已达到最大可管理容器数</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">if</span> !defined(WIN32)</span></span><br><span class="line">    <span class="meta">#<span class="keyword">ifndef</span> __stdcall</span></span><br><span class="line">        <span class="meta">#<span class="keyword">define</span> __stdcall</span></span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEVAPI __stdcall</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span>    IN</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> OUT</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*布尔类型定义</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">undef</span> TRUE</span></span><br><span class="line"><span class="meta">#<span class="keyword">undef</span> FALSE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TRUE            0x00000001    <span class="comment">//布尔值为真</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FALSE            0x00000000    <span class="comment">//布尔值为假</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*基本数据类型</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">signed</span> <span class="type">char</span>         INT8;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">signed</span> <span class="type">short</span>        INT16;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">signed</span> <span class="type">int</span>          INT32;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">char</span>       UINT8;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">short</span>      UINT16;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span>        UINT32;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">typedef</span> UINT8                BYTE;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">char</span>                CHAR;</span><br><span class="line"><span class="keyword">typedef</span> INT16                SHORT;</span><br><span class="line"><span class="keyword">typedef</span> UINT16                USHORT;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int</span>                    LONG;</span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> ULONG</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span>        ULONG;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span>        SKF_ULONG;</span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> UINT</span></span><br><span class="line"><span class="keyword">typedef</span> UINT32                UINT;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="keyword">typedef</span> UINT16                WORD;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">unsigned</span> <span class="type">int</span>        DWORD;</span><br><span class="line"><span class="keyword">typedef</span> UINT32                FLAGS;</span><br><span class="line"><span class="keyword">typedef</span> CHAR *                LPSTR;</span><br><span class="line"><span class="meta">#<span class="keyword">undef</span>    HANDLE</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span> *                HANDLE;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int</span>                    BOOL;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">typedef</span> HANDLE                DEVHANDLE;</span><br><span class="line"><span class="keyword">typedef</span> HANDLE                HAPPLICATION;</span><br><span class="line"><span class="keyword">typedef</span> HANDLE                HCONTAINER;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*临界值定义</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_IV_LEN            32        <span class="comment">//初始化向量的最大长度</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>    MAX_FILE_NAME_LEN    32        <span class="comment">//文件名最大长度</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_CONTAINER_NAME_LEN    128    <span class="comment">//容器名最大长度</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MIN_PIN_LEN            6        <span class="comment">//最小的PIN长度</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_RSA_MODULUS_LEN 256        <span class="comment">//RSA算法模数的最大长度</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_RSA_EXPONENT_LEN 4        <span class="comment">//RSA算法指数的最大长度</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ECC_MAX_XCOORDINATE_BITS_LEN 512    <span class="comment">//ECC算法X座标的最大长度</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ECC_MAX_YCOORDINATE_BITS_LEN 512    <span class="comment">//ECC算法Y座标的最大长度</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ECC_MAX_MODULUS_BITS_LEN 512        <span class="comment">//ECC算法模数的最大长度</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*算法标识符</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SM1_ECB        0x00000101    <span class="comment">//SM1算法ECB加密模式</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SM1_CBC        0x00000102    <span class="comment">//SM1算法CBC加密模式</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SM1_CFB        0x00000104    <span class="comment">//SM1算法CFB加密模式</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SM1_OFB        0x00000108    <span class="comment">//SM1算法OFB加密模式</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SM1_MAC        0x00000110    <span class="comment">//SM1算法MAC运算</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SSF33_ECB    0x00000201    <span class="comment">//SSF33算法ECB加密模式</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SSF33_CBC    0x00000202    <span class="comment">//SSF33算法CBC加密模式</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SSF33_CFB    0x00000204    <span class="comment">//SSF33算法CFB加密模式</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SSF33_OFB    0x00000208    <span class="comment">//SSF33算法OFB加密模式</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SSF33_MAC    0x00000210    <span class="comment">//SSF33算法MAC运算</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SMS4_ECB    0x00000401    <span class="comment">//SMS4算法ECB加密模式</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SMS4_CBC    0x00000402    <span class="comment">//SMS4算法CBC加密模式</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SMS4_CFB    0x00000404    <span class="comment">//SMS4算法CFB加密模式</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SMS4_OFB    0x00000408    <span class="comment">//SMS4算法OFB加密模式</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SMS4_MAC    0x00000410    <span class="comment">//SMS4算法MAC运算</span></span></span><br><span class="line"><span class="comment">//////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">//广东ca支持</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_DES_ECB 0x00001001</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_DES_CBC 0x00001002</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_3DES_ECB 0x00002001</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_3DES_CBC 0x00002002</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_3DES_CFB 0x00002004</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_3DES_OFB 0x00002008</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_3DES_MAC 0x00002010</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_AES128_ECB 0x00004001</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_AES128_CBC 0x00004002</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_AES128_CFB 0x00004004</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_AES128_OFB 0x00004008</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_AES128_MAC 0x00004010</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_AES192_ECB 0x00008001</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_AES192_CBC 0x00008002</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_AES192_CFB 0x00008004</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_AES192_OFB 0x00008008</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_AES256_ECB 0x00010001</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_AES256_CBC 0x00010002</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_AES256_CFB 0x00010004</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_AES256_OFB 0x00010008</span></span><br><span class="line"><span class="comment">//////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">/*    0x00000400-0x800000xx    为其它分组密码算法预留    */</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_RSA            0x00010000    <span class="comment">//RSA算法</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SM2_1        0x00020100    <span class="comment">//椭圆曲线签名算法</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SM2_2        0x00020200    <span class="comment">//椭圆曲线密钥交换协议</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SM2_3        0x00020400    <span class="comment">//椭圆曲线加密算法</span></span></span><br><span class="line"><span class="comment">/*    0x00000400～0x800000xx    为其它非对称密码算法预留    */</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SM3            0x00000001    <span class="comment">//SM3杂凑算法</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SHA1        0x00000002    <span class="comment">//SHA1杂凑算法</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SGD_SHA256        0x00000004    <span class="comment">//SHA256杂凑算法</span></span></span><br><span class="line"><span class="comment">/*    0x00000010～0x000000FF    为其它密码杂凑算法预留    */</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*设备状态</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>    DEV_ABSENT_STATE        0x00000000        <span class="comment">//设备不存在</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>    DEV_PRESENT_STATE        0x00000001        <span class="comment">//设备存在</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEV_UNKNOW_STATE        0x00000002     <span class="comment">//设备状态未知</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*密钥类型</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KT_PUBLIC_KEY        0x01        <span class="comment">//公钥</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KT_PRIVATE_KEY        0x02        <span class="comment">//私钥</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> KT_SECRET_KEY        0x03        <span class="comment">//密钥</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*密钥应用类型</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AT_EXTERNAL_AUTHENTICATE_KEY    0x00000001        <span class="comment">//用于设备对终端的认证</span></span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*权限类型</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SECURE_NEVER_ACCOUNT    0x00000000        <span class="comment">//不允许</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SECURE_ADM_ACCOUNT        0x00000001        <span class="comment">//管理员权限</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SECURE_USER_ACCOUNT        0x00000010        <span class="comment">//用户权限</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SECURE_EVERYONE_ACCOUNT    0x000000FF        <span class="comment">//任何人</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*PIN类型</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ADMIN_TYPE                0                <span class="comment">//管理员PIN</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> USER_TYPE                1                <span class="comment">//用户PIN</span></span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  容器类型</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ContainerType_Empty     0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ContainerType_RSA        1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ContainerType_ECC        2</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> pack(1)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*版本</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Struct_Version</span>&#123;</span></span><br><span class="line">    BYTE    major;                    <span class="comment">//主版本号</span></span><br><span class="line">    BYTE    minor;                    <span class="comment">//次版本号</span></span><br><span class="line">&#125; VERSION;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*设备信息</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Struct_DEVINFO</span>&#123;</span> VERSION Version;           </span><br><span class="line">    CHAR    Manufacturer[<span class="number">64</span>];        <span class="comment">//设备厂商信息</span></span><br><span class="line">    CHAR    Issuer[<span class="number">64</span>];                <span class="comment">//应用发行者信息</span></span><br><span class="line">    CHAR    Label[<span class="number">32</span>];                <span class="comment">//标签</span></span><br><span class="line">    CHAR    SerialNumber[<span class="number">32</span>];        <span class="comment">//序列号</span></span><br><span class="line">    VERSION HWVersion;                <span class="comment">//设备硬件版本</span></span><br><span class="line">    VERSION FirmwareVersion;        <span class="comment">//设备本身固件版本</span></span><br><span class="line">    ULONG        AlgSymCap;</span><br><span class="line">    ULONG        AlgAsymCap;</span><br><span class="line">    ULONG        AlgHashCap;</span><br><span class="line">    ULONG        DevAuthAlgId;        <span class="comment">//设备认证密钥的ID</span></span><br><span class="line">    ULONG        TotalSpace;</span><br><span class="line">    ULONG        FreeSpace;</span><br><span class="line">    ULONG        MaxECCBufferSize;    <span class="comment">//能够处理的ECC加密数据大小</span></span><br><span class="line">    ULONG        MaxBufferSize;        <span class="comment">//能够处理的分组运算和杂凑运算的数据大小</span></span><br><span class="line">    BYTE          Reserved[<span class="number">64</span>];</span><br><span class="line">&#125;DEVINFO,*PDEVINFO;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*RSA公钥交换数据块</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Struct_RSAPUBLICKEYBLOB</span>&#123;</span></span><br><span class="line">    UINT32    AlgID;                                    <span class="comment">//算法标识号</span></span><br><span class="line">    UINT32    BitLen;                                    <span class="comment">//模数的实际位长度，必须是8的倍数</span></span><br><span class="line">    BYTE    Modulus[MAX_RSA_MODULUS_LEN];            <span class="comment">//模数n=p*q，实际长度为BitLen/8字节</span></span><br><span class="line">    BYTE    PublicExponent[MAX_RSA_EXPONENT_LEN];    <span class="comment">//公开密钥e， 一般为00010001</span></span><br><span class="line">&#125; RSAPUBLICKEYBLOB, *PRSAPUBLICKEYBLOB;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*RSA私钥交换数据块</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Struct_RSAPRIVATEKEYBLOB</span>&#123;</span></span><br><span class="line">    UINT32    AlgID;                                    <span class="comment">//算法标识号</span></span><br><span class="line">    UINT32    BitLen;                                    <span class="comment">//模数的实际位长度，必须是8的倍数</span></span><br><span class="line">    BYTE    Modulus[MAX_RSA_MODULUS_LEN];            <span class="comment">//模数n=p*q，实际长度为BitLen/8字节</span></span><br><span class="line">    BYTE    PublicExponent[MAX_RSA_EXPONENT_LEN];    <span class="comment">//公开密钥e， 一般为00010001</span></span><br><span class="line">    BYTE    PrivateExponent[MAX_RSA_MODULUS_LEN];    <span class="comment">//私有密钥d，实际长度为BitLen/8字节</span></span><br><span class="line">    BYTE    Prime1[MAX_RSA_MODULUS_LEN/<span class="number">2</span>];            <span class="comment">//素数p，实际长度为BitLen/16字节</span></span><br><span class="line">    BYTE    Prime2[MAX_RSA_MODULUS_LEN/<span class="number">2</span>];            <span class="comment">//素数q，实际长度为BitLen/16字节</span></span><br><span class="line">    BYTE    Prime1Exponent[MAX_RSA_MODULUS_LEN/<span class="number">2</span>];    <span class="comment">//d mod (p-1)的值, 实际长度为BitLen/16字节</span></span><br><span class="line">    BYTE    Prime2Exponent[MAX_RSA_MODULUS_LEN/<span class="number">2</span>];    <span class="comment">//d mod (q-1)的值，实际长度为BitLen/16字节</span></span><br><span class="line">    BYTE    Coefficient[MAX_RSA_MODULUS_LEN/<span class="number">2</span>];        <span class="comment">//q模p的乘法逆元，实际长度为BitLen/16字节</span></span><br><span class="line">&#125; RSAPRIVATEKEYBLOB, *PRSAPRIVATEKEYBLOB;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*ECC公钥交换数据块</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Struct_ECCPUBLICKEYBLOB</span>&#123;</span></span><br><span class="line">    UINT32    BitLen;</span><br><span class="line">    BYTE    XCoordinate[ECC_MAX_XCOORDINATE_BITS_LEN/<span class="number">8</span>];</span><br><span class="line">    BYTE    YCoordinate[ECC_MAX_YCOORDINATE_BITS_LEN/<span class="number">8</span>];</span><br><span class="line">&#125;ECCPUBLICKEYBLOB, *PECCPUBLICKEYBLOB;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*ECC私钥交换数据块</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Struct_ECCPRIVATEKEYBLOB</span>&#123;</span></span><br><span class="line">    UINT32    BitLen;</span><br><span class="line">    BYTE    PrivateKey[ECC_MAX_MODULUS_BITS_LEN/<span class="number">8</span>];</span><br><span class="line">&#125;ECCPRIVATEKEYBLOB, *PECCPRIVATEKEYBLOB;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Struct_ECCCIPHERBLOB</span>&#123;</span></span><br><span class="line">    BYTE    XCoordinate[ECC_MAX_XCOORDINATE_BITS_LEN/<span class="number">8</span>];</span><br><span class="line">    BYTE    YCoordinate[ECC_MAX_XCOORDINATE_BITS_LEN/<span class="number">8</span>];</span><br><span class="line">    BYTE    HASH[<span class="number">32</span>];</span><br><span class="line">    ULONG    CipherLen;</span><br><span class="line">    BYTE    Cipher[<span class="number">1</span>];</span><br><span class="line">&#125; ECCCIPHERBLOB, *PECCCIPHERBLOB;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Struct_ECCSIGNATUREBLOB</span>&#123;</span></span><br><span class="line">    BYTE    r[ECC_MAX_XCOORDINATE_BITS_LEN/<span class="number">8</span>];</span><br><span class="line">    BYTE    s[ECC_MAX_YCOORDINATE_BITS_LEN/<span class="number">8</span>];</span><br><span class="line">&#125; ECCSIGNATUREBLOB, *PECCSIGNATUREBLOB;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//　ECC加密密钥对保护结构</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">SKF_ENVELOPEDKEYBLOB</span>&#123;</span></span><br><span class="line">    ULONG Version;                  <span class="comment">// 当前版本为 1</span></span><br><span class="line">    ULONG ulSymmAlgID;              <span class="comment">// 对称算法标识，限定ECB模式</span></span><br><span class="line">    ULONG ulBits;                    <span class="comment">// 加密密钥对的密钥位长度</span></span><br><span class="line">    BYTE cbEncryptedPriKey[<span class="number">64</span>];     <span class="comment">// 加密密钥对私钥的密文</span></span><br><span class="line">    ECCPUBLICKEYBLOB PubKey;        <span class="comment">// 加密密钥对的公钥</span></span><br><span class="line">    ECCCIPHERBLOB ECCCipherBlob;    <span class="comment">// 用保护公钥加密的对称密钥密文。</span></span><br><span class="line">&#125;ENVELOPEDKEYBLOB, *PENVELOPEDKEYBLOB;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*分组密码参数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Struct_BLOCKCIPHERPARAM</span>&#123;</span></span><br><span class="line">    BYTE    IV[MAX_IV_LEN];            <span class="comment">//初始向量，MAX_IV_LEN为初始向量的最大长度</span></span><br><span class="line">    ULONG    IVLen;                    <span class="comment">//初始向量实际长度，按字节计算</span></span><br><span class="line">    ULONG    PaddingType;            <span class="comment">//填充方式，0表示不填充，1表示按照PKCS#5方式进行填充</span></span><br><span class="line">    ULONG    FeedBitLen;                <span class="comment">//反馈值的位长度，按字节计算，只针对OFB、CFB模式</span></span><br><span class="line">&#125; BLOCKCIPHERPARAM, *PBLOCKCIPHERPARAM;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*文件属性</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Struct_FILEATTRIBUTE</span>&#123;</span></span><br><span class="line">    CHAR    FileName[<span class="number">32</span>];            <span class="comment">//文件名</span></span><br><span class="line">    UINT32    FileSize;                <span class="comment">//文件大小</span></span><br><span class="line">    UINT32    ReadRights;                <span class="comment">//读权限</span></span><br><span class="line">    UINT32    WriteRights;            <span class="comment">//写权限</span></span><br><span class="line">&#125; FILEATTRIBUTE, *PFILEATTRIBUTE;</span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> pack()</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/*    1. 设备管理                                                            */</span></span><br><span class="line"><span class="comment">/*    SKF_WaitForDevEvent                                                    */</span></span><br><span class="line"><span class="comment">/*    SKF_EnumDev                                                            */</span></span><br><span class="line"><span class="comment">/*    SKF_ConnectDev                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_DisconnectDev                                                    */</span></span><br><span class="line"><span class="comment">/*    SKF_GetDevState                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_GetDevInfo                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_LockDev                                                            */</span></span><br><span class="line"><span class="comment">/*    SKF_UnlockDev                                                        */</span></span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    等待设备的插拔事件</span></span><br><span class="line"><span class="comment"> *    szDevName        [OUT]返回发生事件的设备名称</span></span><br><span class="line"><span class="comment"> *    pulDevNameLen    [IN,OUT]输入/输出参数，当输入时表示缓冲区长度，输出时表示设备名称的有效长度,长度包含字符串结束符</span></span><br><span class="line"><span class="comment"> *    pulEvent        [OUT]事件类型。1表示插入，2表示拔出</span></span><br><span class="line"><span class="comment"> *    备注: 该函数是阻塞调用的</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_WaitForDevEvent</span><span class="params">(LPSTR szDevName,ULONG *pulDevNameLen, ULONG *pulEvent)</span>;</span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_CancelWaitForDevEvent</span><span class="params">()</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    获得当前系统中的设备列表</span></span><br><span class="line"><span class="comment"> *    bPresent        [IN]为TRUE表示取当前设备状态为存在的设备列表。为FALSE表示取当前驱动支持的设备列表</span></span><br><span class="line"><span class="comment"> *    szNameList        [OUT]设备名称列表。如果该参数为NULL，将由pulSize返回所需要的内存空间大小。每个设备的名称以单个&#x27;\0&#x27;结束，以双&#x27;\0&#x27;表示列表的结束</span></span><br><span class="line"><span class="comment"> *    pulSize            [IN,OUT]输入参数，输入设备名称列表的缓冲区长度，输出参数，返回szNameList所需要的空间大小</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_EnumDev</span><span class="params">(BOOL bPresent, LPSTR szNameList, ULONG *pulSize)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    通过设备名称连接设备，返回设备的句柄</span></span><br><span class="line"><span class="comment"> *    szName        [IN]设备名称</span></span><br><span class="line"><span class="comment"> *    phDev        [OUT]返回设备操作句柄</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ConnectDev</span> <span class="params">(LPSTR szName, DEVHANDLE *phDev)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    断开一个已经连接的设备，并释放句柄。</span></span><br><span class="line"><span class="comment"> *    hDev        [IN]连接设备时返回的设备句柄</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_DisConnectDev</span> <span class="params">(DEVHANDLE hDev)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    获取设备是否存在的状态</span></span><br><span class="line"><span class="comment"> *    szDevName    [IN]连接名称</span></span><br><span class="line"><span class="comment"> *    pulDevState    [OUT]返回设备状态</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_GetDevState</span><span class="params">(LPSTR szDevName, ULONG *pulDevState)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    设置设备标签</span></span><br><span class="line"><span class="comment"> *    hDev        [IN]连接设备时返回的设备句柄</span></span><br><span class="line"><span class="comment"> *    szLabel        [OUT]设备标签字符串。该字符串应小于32字节</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_SetLabel</span> <span class="params">(DEVHANDLE hDev, LPSTR szLabel)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    获取设备的一些特征信息，包括设备标签、厂商信息、支持的算法等</span></span><br><span class="line"><span class="comment"> *    hDev        [IN]连接设备时返回的设备句柄</span></span><br><span class="line"><span class="comment"> *    pDevInfo    [OUT]返回设备信息</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_GetDevInfo</span> <span class="params">(DEVHANDLE hDev, DEVINFO *pDevInfo)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    获得设备的独占使用权</span></span><br><span class="line"><span class="comment"> *    hDev        [IN]连接设备时返回的设备句柄</span></span><br><span class="line"><span class="comment"> *    ulTimeOut    [IN]超时时间，单位为毫秒。如果为0xFFFFFFFF表示无限等待</span></span><br><span class="line"><span class="comment"> */</span>   </span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_LockDev</span> <span class="params">(DEVHANDLE hDev, ULONG ulTimeOut)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    释放对设备的独占使用权</span></span><br><span class="line"><span class="comment"> *    hDev        [IN]连接设备时返回的设备句柄</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_UnlockDev</span> <span class="params">(DEVHANDLE hDev)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/*  2. 访问控制                                                            */</span></span><br><span class="line"><span class="comment">/*    SKF_ChangeDevAuthKey                                                */</span></span><br><span class="line"><span class="comment">/*    SKF_DevAuth                                                            */</span></span><br><span class="line"><span class="comment">/*    SKF_ChangePIN                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_GetPINInfo                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_VerifyPIN                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_UnblockPIN                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_ClearSecureState                                                */</span></span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    更改设备认证密钥</span></span><br><span class="line"><span class="comment"> *    hDev        [IN]连接时返回的设备句柄</span></span><br><span class="line"><span class="comment"> *    pbKeyValue    [IN]密钥值</span></span><br><span class="line"><span class="comment"> *    ulKeyLen    [IN]密钥长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ChangeDevAuthKey</span> <span class="params">(DEVHANDLE hDev, BYTE *pbKeyValue, ULONG ulKeyLen)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    设备认证是设备对应用程序的认证</span></span><br><span class="line"><span class="comment"> *    hDev            [IN]连接时返回的设备句柄</span></span><br><span class="line"><span class="comment"> *    pbAuthData        [IN]认证数据</span></span><br><span class="line"><span class="comment"> *    ulLen            [IN]认证数据的长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_DevAuth</span> <span class="params">(DEVHANDLE hDev, BYTE *pbAuthData,ULONG ulLen)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    修改PIN，可以修改Admin和User的PIN，如果原PIN错误，返回剩余重试次数，当剩余次数为0时，表示PIN已经被锁死</span></span><br><span class="line"><span class="comment"> *    hApplication    [IN]应用句柄</span></span><br><span class="line"><span class="comment"> *    ulPINType        [IN]PIN类型，可以为ADMIN_TYPE=0，或USER_TYPE=1</span></span><br><span class="line"><span class="comment"> *    szOldPIN        [IN]原PIN值</span></span><br><span class="line"><span class="comment"> *    szNewPIN        [IN]新PIN值</span></span><br><span class="line"><span class="comment"> *    pulRetryCount    [OUT]出错后重试次数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ChangePIN</span> <span class="params">(HAPPLICATION hApplication, ULONG ulPINType, LPSTR szOldPin, LPSTR szNewPin, ULONG *pulRetryCount)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    获取PIN码信息，包括最大重试次数、当前剩余重试次数，以及当前PIN码是否为出厂默认PIN码</span></span><br><span class="line"><span class="comment"> *    hApplication        [IN]应用句柄</span></span><br><span class="line"><span class="comment"> *    ulPINType            [IN]PIN类型</span></span><br><span class="line"><span class="comment"> *    pulMaxRetryCount    [OUT]最大重试次数</span></span><br><span class="line"><span class="comment"> *    pulRemainRetryCount    [OUT]当前剩余重试次数，当为0时表示已锁死</span></span><br><span class="line"><span class="comment"> *    pbDefaultPin        [OUT]是否为出厂默认PIN码</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_GetPINInfo</span><span class="params">(HAPPLICATION hApplication, ULONG  ulPINType, ULONG *pulMaxRetryCount, ULONG *pulRemainRetryCount, BOOL *pbDefaultPin)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    校验PIN码。校验成功后，会获得相应的权限，如果PIN码错误，会返回PIN码的重试次数，当重试次数为0时表示PIN码已经锁死</span></span><br><span class="line"><span class="comment"> *    hApplication    [IN]应用句柄</span></span><br><span class="line"><span class="comment"> *    ulPINType        [IN]PIN类型，可以为ADMIN_TYPE=0，或USER_TYPE=1</span></span><br><span class="line"><span class="comment"> *    szPIN            [IN]PIN值</span></span><br><span class="line"><span class="comment"> *    pulRetryCount    [OUT]出错后返回的重试次数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_VerifyPIN</span> <span class="params">(HAPPLICATION hApplication, ULONG  ulPINType, LPSTR szPIN, ULONG *pulRetryCount)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    当用户的PIN码锁死后，通过调用该函数来解锁用户PIN码。</span></span><br><span class="line"><span class="comment"> *    解锁后，用户PIN码被设置成新值，用户PIN码的重试次数也恢复到原值。</span></span><br><span class="line"><span class="comment"> *    hApplication    [IN]应用句柄</span></span><br><span class="line"><span class="comment"> *    szAdminPIN        [IN]管理员PIN码</span></span><br><span class="line"><span class="comment"> *    szNewUserPIN    [IN]新的用户PIN码</span></span><br><span class="line"><span class="comment"> *    pulRetryCount    [OUT]管理员PIN码错误时，返回剩余重试次数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_UnblockPIN</span> <span class="params">(HAPPLICATION hApplication, LPSTR szAdminPIN, LPSTR szNewUserPIN,  ULONG *pulRetryCount)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    清除应用当前的安全状态</span></span><br><span class="line"><span class="comment"> *    hApplication    [IN]应用句柄</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ClearSecureState</span> <span class="params">(HAPPLICATION hApplication)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/*  3. 应用管理                                                            */</span></span><br><span class="line"><span class="comment">/*    SKF_CreateApplication                                                */</span></span><br><span class="line"><span class="comment">/*    SKF_EnumApplication                                                    */</span></span><br><span class="line"><span class="comment">/*    SKF_DeleteApplication                                                */</span></span><br><span class="line"><span class="comment">/*    SKF_OpenApplication                                                    */</span></span><br><span class="line"><span class="comment">/*    SKF_CloseApplication                                                */</span></span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    创建一个应用</span></span><br><span class="line"><span class="comment"> *    hDev                    [IN]连接设备时返回的设备句柄</span></span><br><span class="line"><span class="comment"> *    szAppName                [IN]应用名称</span></span><br><span class="line"><span class="comment"> *    szAdminPIN                [IN]管理员PIN</span></span><br><span class="line"><span class="comment"> *    dwAdminPinRetryCount    [IN]管理员PIN最大重试次数</span></span><br><span class="line"><span class="comment"> *    szUserPIN                [IN]用户PIN</span></span><br><span class="line"><span class="comment"> *    dwAdminPinRetryCount    [IN]用户PIN最大重试次数</span></span><br><span class="line"><span class="comment"> *    dwCreateFileRights        [IN]在该应用下创建文件和容器的权限</span></span><br><span class="line"><span class="comment"> *    phApplication            [OUT]应用的句柄</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_CreateApplication</span><span class="params">(DEVHANDLE hDev, LPSTR szAppName, LPSTR szAdminPin, DWORD dwAdminPinRetryCount,LPSTR szUserPin, DWORD dwUserPinRetryCount,DWORD dwCreateFileRights, HAPPLICATION *phApplication)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    枚举设备中所存在的所有应用</span></span><br><span class="line"><span class="comment"> *    hDev            [IN]连接设备时返回的设备句柄</span></span><br><span class="line"><span class="comment"> *    szAppName        [OUT]返回应用名称列表, 如果该参数为空，将由pulSize返回所需要的内存空间大小。</span></span><br><span class="line"><span class="comment"> *                         每个应用的名称以单个&#x27;\0&#x27;结束，以双&#x27;\0&#x27;表示列表的结束。</span></span><br><span class="line"><span class="comment"> *    pulSize            [IN,OUT]输入参数，输入应用名称的缓冲区长度，输出参数，返回szAppName所占用的的空间大小</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_EnumApplication</span><span class="params">(DEVHANDLE hDev, LPSTR szAppName,ULONG *pulSize)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    删除指定的应用</span></span><br><span class="line"><span class="comment"> *    hDev            [IN]连接设备时返回的设备句柄</span></span><br><span class="line"><span class="comment"> *    szAppName        [IN]应用名称</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_DeleteApplication</span><span class="params">(DEVHANDLE hDev, LPSTR szAppName)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    打开指定的应用</span></span><br><span class="line"><span class="comment"> *    hDev            [IN]连接设备时返回的设备句柄</span></span><br><span class="line"><span class="comment"> *    szAppName        [IN]应用名称</span></span><br><span class="line"><span class="comment"> *    phApplication    [OUT]应用的句柄</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_OpenApplication</span><span class="params">(DEVHANDLE hDev, LPSTR szAppName, HAPPLICATION *phApplication)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    关闭应用并释放应用句柄</span></span><br><span class="line"><span class="comment"> *    hApplication    [IN]应用的句柄</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_CloseApplication</span><span class="params">(HAPPLICATION hApplication)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/*  4. 文件管理                                                            */</span></span><br><span class="line"><span class="comment">/*    SKF_CreateFile                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_DeleteFile                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_EnumFiles                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_GetFileInfo                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_ReadFile                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_WriteFile                                                        */</span></span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    创建一个文件。创建文件时要指定文件的名称，大小，以及文件的读写权限</span></span><br><span class="line"><span class="comment"> *    hApplication        [IN]应用句柄</span></span><br><span class="line"><span class="comment"> *    szFileName            [IN]文件名称，长度不得大于32个字节</span></span><br><span class="line"><span class="comment"> *    ulFileSize            [IN]文件大小</span></span><br><span class="line"><span class="comment"> *    ulReadRights        [IN]文件读权限</span></span><br><span class="line"><span class="comment"> *    ulWriteRights        [IN]文件写权限</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_CreateFile</span> <span class="params">(HAPPLICATION hApplication, LPSTR szFileName, ULONG ulFileSize, ULONG ulReadRights,ULONG ulWriteRights)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    删除指定文件，文件删除后，文件中写入的所有信息将丢失。文件在设备中的占用的空间将被释放。</span></span><br><span class="line"><span class="comment"> *    hApplication        [IN]要删除文件所在的应用句柄</span></span><br><span class="line"><span class="comment"> *    szFileName            [IN]要删除文件的名称</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_DeleteFile</span> <span class="params">(HAPPLICATION hApplication, LPSTR szFileName)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    枚举一个应用下存在的所有文件</span></span><br><span class="line"><span class="comment"> *    hApplication        [IN]应用的句柄</span></span><br><span class="line"><span class="comment"> *    szFileList            [OUT]返回文件名称列表，该参数为空，由pulSize返回文件信息所需要的空间大小。每个文件名称以单个&#x27;\0&#x27;结束，以双&#x27;\0&#x27;表示列表的结束。</span></span><br><span class="line"><span class="comment"> *    pulSize                [OUT]输入为数据缓冲区的大小，输出为实际文件名称的大小</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_EnumFiles</span> <span class="params">(HAPPLICATION hApplication, LPSTR szFileList, ULONG *pulSize)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    获取应用文件的属性信息，例如文件的大小、权限等</span></span><br><span class="line"><span class="comment"> *    hApplication        [IN]文件所在应用的句柄</span></span><br><span class="line"><span class="comment"> *    szFileName            [IN]文件名称</span></span><br><span class="line"><span class="comment"> *    pFileInfo            [OUT]文件信息，指向文件属性结构的指针</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_GetFileInfo</span> <span class="params">(HAPPLICATION hApplication, LPSTR szFileName, FILEATTRIBUTE *pFileInfo)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    读取文件内容</span></span><br><span class="line"><span class="comment"> *    hApplication        [IN]文件所在的应用句柄</span></span><br><span class="line"><span class="comment"> *    szFileName            [IN]文件名</span></span><br><span class="line"><span class="comment"> *    ulOffset            [IN]文件读取偏移位置</span></span><br><span class="line"><span class="comment"> *    ulSize                [IN]要读取的长度</span></span><br><span class="line"><span class="comment"> *    pbOutData            [OUT]返回数据的缓冲区</span></span><br><span class="line"><span class="comment"> *    pulOutLen            [OUT]输入表示给出的缓冲区大小；输出表示实际读取返回的数据大小</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ReadFile</span> <span class="params">(HAPPLICATION hApplication, LPSTR szFileName, ULONG ulOffset, ULONG ulSize, BYTE * pbOutData, ULONG *pulOutLen)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    写数据到文件中</span></span><br><span class="line"><span class="comment"> *    hApplication        [IN]文件所在的应用句柄</span></span><br><span class="line"><span class="comment"> *    szFileName            [IN]文件名</span></span><br><span class="line"><span class="comment"> *    ulOffset            [IN]写入文件的偏移量</span></span><br><span class="line"><span class="comment"> *    pbData                [IN]写入数据缓冲区</span></span><br><span class="line"><span class="comment"> *    ulSize                [IN]写入数据的大小</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_WriteFile</span> <span class="params">(HAPPLICATION hApplication, LPSTR szFileName, ULONG  ulOffset, BYTE *pbData, ULONG ulSize)</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/*  5. 容器管理                                                            */</span></span><br><span class="line"><span class="comment">/*    SKF_CreateContainer                                                    */</span></span><br><span class="line"><span class="comment">/*    SKF_DeleteContainer                                                    */</span></span><br><span class="line"><span class="comment">/*    SKF_OpenContainer                                                    */</span></span><br><span class="line"><span class="comment">/*    SKF_CloseContainer                                                    */</span></span><br><span class="line"><span class="comment">/*    SKF_EnumContainer                                                    */</span></span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    在应用下建立指定名称的容器并返回容器句柄</span></span><br><span class="line"><span class="comment"> *    hApplication        [IN]应用句柄</span></span><br><span class="line"><span class="comment"> *    szContainerName        [IN]ASCII字符串，表示所建立容器的名称，容器名称的最大长度不能超过64字节</span></span><br><span class="line"><span class="comment"> *    phContainer            [OUT]返回所建立容器的容器句柄</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_CreateContainer</span> <span class="params">(HAPPLICATION hApplication, LPSTR szContainerName, HCONTAINER *phContainer)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    在应用下删除指定名称的容器并释放容器相关的资源</span></span><br><span class="line"><span class="comment"> *    hApplication        [IN]应用句柄</span></span><br><span class="line"><span class="comment"> *    szContainerName        [IN]指向删除容器的名称</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_DeleteContainer</span><span class="params">(HAPPLICATION hApplication, LPSTR szContainerName)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    获取容器句柄</span></span><br><span class="line"><span class="comment"> *    hApplication        [IN]应用句柄</span></span><br><span class="line"><span class="comment"> *    szContainerName        [IN]容器名称</span></span><br><span class="line"><span class="comment"> *    phContainer            [OUT]返回所打开容器的句柄</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_OpenContainer</span><span class="params">(HAPPLICATION hApplication,LPSTR szContainerName,HCONTAINER *phContainer)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    关闭容器句柄，并释放容器句柄相关资源</span></span><br><span class="line"><span class="comment"> *    hContainer            [OUT]容器句柄</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_CloseContainer</span><span class="params">(HCONTAINER hContainer)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    枚举应用下的所有容器并返回容器名称列表</span></span><br><span class="line"><span class="comment"> *    hApplication        [IN]应用句柄</span></span><br><span class="line"><span class="comment"> *    szContainerName        [OUT]指向容器名称列表缓冲区，如果此参数为NULL时，pulSize表示返回数据所需要缓冲区的长度，如果此参数不为NULL时，返回容器名称列表，每个容器名以单个&#x27;\0&#x27;为结束，列表以双&#x27;\0&#x27;结束</span></span><br><span class="line"><span class="comment"> *    pulSize                [OUT]调用前表示szContainerName缓冲区的长度，返回容器名称列表的长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_EnumContainer</span><span class="params">(</span></span><br><span class="line"><span class="params">      IN HAPPLICATION    hApplication,</span></span><br><span class="line"><span class="params">      OUT LPSTR            szContainerName,</span></span><br><span class="line"><span class="params">      OUT ULONG*        pulSize</span></span><br><span class="line"><span class="params">      )</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    获取容器的类型</span></span><br><span class="line"><span class="comment">    hContainer    [IN] 容器句柄。</span></span><br><span class="line"><span class="comment">    pulContainerType    [OUT] 获得的容器类型。指针指向的值为0表示未定、尚未分配类型或者为空容器，为1表示为RSA容器，为2表示为ECC容器。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"> </span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_GetContainerType</span><span class="params">(HCONTAINER hContainer, ULONG *pulContainerType)</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ImportCertificate</span><span class="params">(HCONTAINER hContainer, BOOL bSignFlag,  BYTE* pbCert, ULONG ulCertLen)</span>;</span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ExportCertificate</span><span class="params">(HCONTAINER hContainer, BOOL bSignFlag,  BYTE* pbCert, ULONG *pulCertLen)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/*  6. 密码服务                                                            */</span></span><br><span class="line"><span class="comment">/*    SKF_GetRandom                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_GenExtRSAKey                                                    */</span></span><br><span class="line"><span class="comment">/*    SKF_GenRSAKeyPair                                                    */</span></span><br><span class="line"><span class="comment">/*    SKF_ImportRSAKeyPair                                                */</span></span><br><span class="line"><span class="comment">/*    SKF_RSASignData                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_RSAVerify                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_RSAExportSessionKey                                                */</span></span><br><span class="line"><span class="comment">/*    SKF_ExtRSAPubKeyOperation                                            */</span></span><br><span class="line"><span class="comment">/*    SKF_ExtRSAPriKeyOperation                                            */</span></span><br><span class="line"><span class="comment">/*    SKF_GenECCKeyPair                                                    */</span></span><br><span class="line"><span class="comment">/*    SKF_ImportECCKeyPair                                                */</span></span><br><span class="line"><span class="comment">/*    SKF_ECCSignData                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_ECCVerify                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_ECCExportSessionKey                                                */</span></span><br><span class="line"><span class="comment">/*    SKF_ExtECCEncrypt                                                    */</span></span><br><span class="line"><span class="comment">/*    SKF_ExtECCDecrypt                                                    */</span></span><br><span class="line"><span class="comment">/*    SKF_ExtECCSign                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_ExtECCVerify                                                    */</span></span><br><span class="line"><span class="comment">/*    SKF_ExportPublicKey                                                    */</span></span><br><span class="line"><span class="comment">/*    SKF_ImportSessionKey                                                */</span></span><br><span class="line"><span class="comment">/*    SKF_SetSymmKey                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_EncryptInit                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_Encrypt                                                            */</span></span><br><span class="line"><span class="comment">/*    SKF_EncryptUpdate                                                    */</span></span><br><span class="line"><span class="comment">/*    SKF_EncryptFinal                                                    */</span></span><br><span class="line"><span class="comment">/*    SKF_DecryptInit                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_Decrypt                                                            */</span></span><br><span class="line"><span class="comment">/*    SKF_DecryptUpdate                                                    */</span></span><br><span class="line"><span class="comment">/*    SKF_DecryptFinal                                                    */</span></span><br><span class="line"><span class="comment">/*    SKF_DegistInit                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_Degist                                                            */</span></span><br><span class="line"><span class="comment">/*    SKF_DegistUpdate                                                    */</span></span><br><span class="line"><span class="comment">/*    SKF_DegistFinal                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_MACInit                                                            */</span></span><br><span class="line"><span class="comment">/*    SKF_MAC                                                                */</span></span><br><span class="line"><span class="comment">/*    SKF_MACUpdate                                                        */</span></span><br><span class="line"><span class="comment">/*    SKF_MACFinal                                                        */</span></span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    产生指定长度的随机数</span></span><br><span class="line"><span class="comment"> *    hDev            [IN] 设备句柄</span></span><br><span class="line"><span class="comment"> *    pbRandom        [OUT] 返回的随机数</span></span><br><span class="line"><span class="comment"> *    ulRandomLen        [IN] 随机数长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_GenRandom</span> <span class="params">(DEVHANDLE hDev, BYTE *pbRandom,ULONG ulRandomLen)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    由设备生成RSA密钥对并明文输出</span></span><br><span class="line"><span class="comment"> *    hDev            [IN] 设备句柄</span></span><br><span class="line"><span class="comment"> *    ulBitsLen        [IN] 密钥模长</span></span><br><span class="line"><span class="comment"> *    pBlob            [OUT] 返回的私钥数据结构</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_GenExtRSAKey</span> <span class="params">(DEVHANDLE hDev, ULONG ulBitsLen, RSAPRIVATEKEYBLOB *pBlob)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    生成RSA签名密钥对并输出签名公钥</span></span><br><span class="line"><span class="comment"> *    hContainer        [IN] 容器句柄</span></span><br><span class="line"><span class="comment"> *    ulBitsLen        [IN] 密钥模长</span></span><br><span class="line"><span class="comment"> *    pBlob            [OUT] 返回的RSA公钥数据结构</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_GenRSAKeyPair</span> <span class="params">(HCONTAINER hContainer, ULONG ulBitsLen, RSAPUBLICKEYBLOB *pBlob)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    导入RSA加密公私钥对</span></span><br><span class="line"><span class="comment"> *    hContainer        [IN] 容器句柄</span></span><br><span class="line"><span class="comment"> *    ulSymAlgId        [IN] 对称算法密钥标识</span></span><br><span class="line"><span class="comment"> *    pbWrappedKey    [IN] 使用该容器内签名公钥保护的对称算法密钥</span></span><br><span class="line"><span class="comment"> *    ulWrappedKeyLen    [IN] 保护的对称算法密钥长度</span></span><br><span class="line"><span class="comment"> *    pbEncryptedData    [IN] 对称算法密钥保护的RSA加密私钥。私钥的格式遵循PKCS #1 v2.1: RSA Cryptography Standard中的私钥格式定义</span></span><br><span class="line"><span class="comment"> *    ulEncryptedDataLen    [IN] 对称算法密钥保护的RSA加密公私钥对长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ImportRSAKeyPair</span> <span class="params">( HCONTAINER hContainer, ULONG ulSymAlgId,</span></span><br><span class="line"><span class="params">                                   BYTE *pbWrappedKey, ULONG ulWrappedKeyLen,</span></span><br><span class="line"><span class="params">                                   BYTE *pbEncryptedData, ULONG ulEncryptedDataLen)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    使用hContainer指定容器的签名私钥，对指定数据pbData进行数字签名。签名后的结果存放到pbSignature缓冲区，设置pulSignLen为签名的长度</span></span><br><span class="line"><span class="comment"> *    hContainer        [IN] 用来签名的私钥所在容器句柄</span></span><br><span class="line"><span class="comment"> *    pbData            [IN] 被签名的数据</span></span><br><span class="line"><span class="comment"> *    ulDataLen        [IN] 签名数据长度，应不大于RSA密钥模长-11</span></span><br><span class="line"><span class="comment"> *    pbSignature        [OUT] 存放签名结果的缓冲区指针，如果值为NULL，用于取得签名结果长度</span></span><br><span class="line"><span class="comment"> *    pulSigLen        [IN,OUT] 输入为签名结果缓冲区大小，输出为签名结果长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_RSASignData</span><span class="params">(HCONTAINER hContainer, BYTE *pbData, ULONG  ulDataLen, BYTE *pbSignature, ULONG *pulSignLen)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    验证RSA签名。用pRSAPubKeyBlob内的公钥值对待验签数据进行验签。</span></span><br><span class="line"><span class="comment"> *    hDev            [IN] 连接设备时返回的设备句柄</span></span><br><span class="line"><span class="comment"> *    pRSAPubKeyBlob    [IN] RSA公钥数据结构</span></span><br><span class="line"><span class="comment"> *    pbData            [IN] 待验证签名的数据</span></span><br><span class="line"><span class="comment"> *    ulDataLen        [IN] 数据长度，应不大于公钥模长-11</span></span><br><span class="line"><span class="comment"> *    pbSignature        [IN] 待验证的签名值</span></span><br><span class="line"><span class="comment"> *    ulSigLen        [IN] 签名值长度，必须为公钥模长</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_RSAVerify</span> <span class="params">(DEVHANDLE hDev , RSAPUBLICKEYBLOB* pRSAPubKeyBlob, BYTE *pbData, ULONG  ulDataLen, BYTE *pbSignature, ULONG ulSignLen)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    生成会话密钥并用外部公钥加密输出。</span></span><br><span class="line"><span class="comment"> *    hContainer        [IN] 容器句柄</span></span><br><span class="line"><span class="comment"> *    ulAlgID            [IN] 会话密钥的算法标识</span></span><br><span class="line"><span class="comment"> *    pPubKey            [IN] 加密会话密钥的RSA公钥数据结构</span></span><br><span class="line"><span class="comment"> *    pbData            [OUT] 导出的加密会话密钥密文，按照PKCS#1v1.5的要求封装</span></span><br><span class="line"><span class="comment"> *    pulDataLen        [OUT] 返回导出数据长度</span></span><br><span class="line"><span class="comment"> *    phSessionKey    [OUT] 导出的密钥句柄</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"> </span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_RSAExportSessionKey</span> <span class="params">(HCONTAINER hContainer, ULONG ulAlgId, RSAPUBLICKEYBLOB *pPubKey, BYTE *pbData, ULONG  *pulDataLen, HANDLE *phSessionKey)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    使用外部传入的RSA公钥对输入数据做公钥运算并输出结果</span></span><br><span class="line"><span class="comment"> *    hDev            [IN] 设备句柄</span></span><br><span class="line"><span class="comment"> *    pRSAPubKeyBlob    [IN] RSA公钥数据结构</span></span><br><span class="line"><span class="comment"> *    pbInput            [IN] 指向待运算的原始数据缓冲区</span></span><br><span class="line"><span class="comment"> *    ulInputLen        [IN] 待运算原始数据的长度，必须为公钥模长</span></span><br><span class="line"><span class="comment"> *    pbOutput        [OUT] 指向RSA公钥运算结果缓冲区，如果该参数为NULL，则由pulOutputLen返回运算结果的实际长度</span></span><br><span class="line"><span class="comment"> *    pulOutputLen    [OUT] 调用前表示pbOutput缓冲区的长度，返回RSA公钥运算结果的实际长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ExtRSAPubKeyOperation</span> <span class="params">(DEVHANDLE hDev, RSAPUBLICKEYBLOB* pRSAPubKeyBlob,BYTE* pbInput, ULONG ulInputLen, BYTE* pbOutput, ULONG* pulOutputLen)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">//　RSA导出会话密钥</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//功能描述    会话密钥用外部RSA公钥加密输出。</span></span><br><span class="line"><span class="comment">//参数    pSessionKey    [IN] 会话密钥句柄。</span></span><br><span class="line"><span class="comment">//pPubKey    [IN] 加密会话密钥的RSA公钥数据结构。</span></span><br><span class="line"><span class="comment">//pbData    [OUT] 导出的加密会话密钥密文。</span></span><br><span class="line"><span class="comment">//pulDataLen    [IN，OUT] 输入时表示会话密钥密文数据缓冲区长度，输出时表示会话密钥密文的实际长度。</span></span><br><span class="line"> </span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_RSAExportSessionKeyEx</span><span class="params">( HANDLE pSessionKey,</span></span><br><span class="line"><span class="params">                                       RSAPUBLICKEYBLOB *pPubKey,</span></span><br><span class="line"><span class="params">                                       BYTE *pbData,</span></span><br><span class="line"><span class="params">                                       ULONG  *pulDataLen)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    直接使用外部传入的RSA私钥对输入数据做私钥运算并输出结果</span></span><br><span class="line"><span class="comment"> *    hDev            [IN] 设备句柄</span></span><br><span class="line"><span class="comment"> *    pRSAPriKeyBlob    [IN] RSA私钥数据结构</span></span><br><span class="line"><span class="comment"> *    pbInput            [IN] 指向待运算数据缓冲区</span></span><br><span class="line"><span class="comment"> *    ulInputLen        [IN] 待运算数据的长度，必须为公钥模长</span></span><br><span class="line"><span class="comment"> *    pbOutput        [OUT] RSA私钥运算结果，如果该参数为NULL，则由pulOutputLen返回运算结果的实际长度</span></span><br><span class="line"><span class="comment"> *    pulOutputLen    [OUT] 调用前表示pbOutput缓冲区的长度，返回RSA私钥运算结果的实际长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ExtRSAPriKeyOperation</span> <span class="params">(DEVHANDLE hDev, RSAPRIVATEKEYBLOB* pRSAPriKeyBlob,BYTE* pbInput, ULONG ulInputLen, BYTE* pbOutput, ULONG* pulOutputLen)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    生成ECC签名密钥对并输出签名公钥。</span></span><br><span class="line"><span class="comment"> *    hContainer        [IN] 容器句柄</span></span><br><span class="line"><span class="comment"> *    只支持SGD_SM2_1算法</span></span><br><span class="line"><span class="comment"> *    pBlob            [OUT] 返回ECC公钥数据结构</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"> </span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_GenECCKeyPair</span> <span class="params">(HCONTAINER hContainer, ULONG ulAlgId, ECCPUBLICKEYBLOB *pBlob)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    导入ECC公私钥对</span></span><br><span class="line"><span class="comment"> *    hContainer        [IN] 容器句柄</span></span><br><span class="line"><span class="comment"> *    pbWrapedData    [IN] 加密保护的ECC加密公私钥对密文</span></span><br><span class="line"><span class="comment"> *    ulWrapedLen        [IN] 数据长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"> </span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ImportECCKeyPair</span> <span class="params">(  HCONTAINER hContainer, PENVELOPEDKEYBLOB pEnvelopedKeyBlob)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    ECC数字签名。采用ECC算法和指定私钥hKey，对指定数据pbData进行数字签名。签名后的结果存放到pbSignature缓冲区，设置pulSignLen为签名值的长度</span></span><br><span class="line"><span class="comment"> *    hContainer        [IN] 用来签名的私钥所在容器句柄</span></span><br><span class="line"><span class="comment"> *    pbData            [IN] 被签名的数据</span></span><br><span class="line"><span class="comment"> *    ulDataLen        [IN] 待签名数据长度，必须小于密钥模长</span></span><br><span class="line"><span class="comment"> *    pbSignature        [OUT] 签名值，为NULL时用于获得签名值的长度</span></span><br><span class="line"><span class="comment"> *    pulSigLen        [IN,OUT] 返回签名值长度的指针</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"> </span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ECCSignData</span> <span class="params">(HCONTAINER hContainer, BYTE *pbData, ULONG  ulDataLen, PECCSIGNATUREBLOB pSignature)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    用ECC公钥对数据进行验签</span></span><br><span class="line"><span class="comment"> *    hDev            [IN] 设备句柄</span></span><br><span class="line"><span class="comment"> *    pECCPubKeyBlob    [IN] ECC公钥数据结构</span></span><br><span class="line"><span class="comment"> *    pbData            [IN] 待验证签名的数据</span></span><br><span class="line"><span class="comment"> *    ulDataLen        [IN] 数据长度</span></span><br><span class="line"><span class="comment"> *    pbSignature        [IN] 待验证的签名值</span></span><br><span class="line"><span class="comment"> *    ulSigLen        [IN] 签名值长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ECCVerify</span> <span class="params">(DEVHANDLE hDev , ECCPUBLICKEYBLOB* pECCPubKeyBlob, BYTE *pbData, ULONG  ulDataLen, PECCSIGNATUREBLOB pSignature)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    生成会话密钥并用外部公钥加密输出。</span></span><br><span class="line"><span class="comment"> *    hContainer        [IN] 容器句柄</span></span><br><span class="line"><span class="comment"> *    ulAlgID            [IN] 会话密钥的算法标识</span></span><br><span class="line"><span class="comment"> *    pPubKey            [IN] 用来导出密钥的密钥结构</span></span><br><span class="line"><span class="comment"> *    pbData            [OUT] 导出的加密会话密钥密文</span></span><br><span class="line"><span class="comment"> *    pulDataLen        [OUT] 返回导出数据长度</span></span><br><span class="line"><span class="comment"> *    phSessionKey    [OUT] 会话密钥句柄</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ECCExportSessionKey</span> <span class="params">(HCONTAINER hContainer, ULONG ulAlgId, ECCPUBLICKEYBLOB *pPubKey, PECCCIPHERBLOB pData, HANDLE *phSessionKey)</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">/////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">///7.6.17　ECC导出会话密钥</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//功能描述    会话密钥用外部ECC公钥加密输出。</span></span><br><span class="line"><span class="comment">//参数    pSessionKey    [IN] 会话密钥句柄。</span></span><br><span class="line"><span class="comment">//pPubKey    [IN] 加密会话密钥的ECC公钥数据结构。</span></span><br><span class="line"><span class="comment">//pbData    [OUT] 导出的加密会话密钥密文，按照GM/T AAAAA    SM2密码使用规范的要求封装。</span></span><br><span class="line"><span class="comment">//pulDataLen    [IN，OUT] 输入时表示会话密钥密文数据缓冲区长度，输出时表示会话密钥密文的实际长度。</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ECCExportSessionKeyEx</span><span class="params">( HANDLE pSessionKey,</span></span><br><span class="line"><span class="params">                                       ECCPUBLICKEYBLOB *pPubKey,</span></span><br><span class="line"><span class="params">                                       BYTE *pbData,</span></span><br><span class="line"><span class="params">                                       ULONG  *pulDataLen)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    使用外部传入的ECC公钥对输入数据做加密运算并输出结果</span></span><br><span class="line"><span class="comment"> *    hDev            [IN] 设备句柄</span></span><br><span class="line"><span class="comment"> *    pECCPubKeyBlob    [IN] ECC公钥数据结构</span></span><br><span class="line"><span class="comment"> *    pbPlainText        [IN] 待加密的明文数据</span></span><br><span class="line"><span class="comment"> *    ulPlainTextLen    [IN] 待加密明文数据的长度</span></span><br><span class="line"><span class="comment"> *    pbCipherText    [OUT] 指向密文数据缓冲区，如果该参数为NULL，则由pulCipherTextLen返回密文数据的实际长度</span></span><br><span class="line"><span class="comment"> *    pulCipherTextLen[OUT] 调用前表示pbCipherText缓冲区的长度，返回密文数据的实际长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ExtECCEncrypt</span> <span class="params">(DEVHANDLE hDev, ECCPUBLICKEYBLOB*  pECCPubKeyBlob,BYTE* pbPlainText, ULONG ulPlainTextLen, PECCCIPHERBLOB pCipherText)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    使用外部传入的ECC私钥对输入数据做解密运算并输出结果</span></span><br><span class="line"><span class="comment"> *    hDev            [IN] 设备句柄</span></span><br><span class="line"><span class="comment"> *    pRSAPriKeyBlob    [IN] ECC私钥数据结构</span></span><br><span class="line"><span class="comment"> *    pbInput            [IN] 待解密的密文数据</span></span><br><span class="line"><span class="comment"> *    ulInputLen        [IN] 待解密密文数据的长度</span></span><br><span class="line"><span class="comment"> *    pbOutput        [OUT] 返回明文数据，如果该参数为NULL，则由pulPlainTextLen返回明文数据的实际长度</span></span><br><span class="line"><span class="comment"> *    pulOutputLen    [OUT] 调用前表示pbPlainText缓冲区的长度，返回明文数据的实际长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ExtECCDecrypt</span> <span class="params">(DEVHANDLE hDev, ECCPRIVATEKEYBLOB*  pECCPriKeyBlob, PECCCIPHERBLOB pCipherText, BYTE* pbPlainText, ULONG* pulPlainTextLen)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    使用外部传入的ECC私钥对输入数据做签名运算并输出结果。</span></span><br><span class="line"><span class="comment"> *    hDev            [IN] 设备句柄</span></span><br><span class="line"><span class="comment"> *    pRSAPriKeyBlob    [IN] ECC私钥数据结构</span></span><br><span class="line"><span class="comment"> *    pbData            [IN] 待签名数据</span></span><br><span class="line"><span class="comment"> *    ulDataLen        [IN] 待签名数据的长度</span></span><br><span class="line"><span class="comment"> *    pbSignature        [OUT] 签名值，如果该参数为NULL，则由pulSignatureLen返回签名结果的实际长度</span></span><br><span class="line"><span class="comment"> *    pulSignatureLen    [OUT] 调用前表示pbSignature缓冲区的长度，返回签名结果的实际长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ExtECCSign</span> <span class="params">(DEVHANDLE hDev, ECCPRIVATEKEYBLOB*  pECCPriKeyBlob, BYTE* pbData, ULONG ulDataLen, PECCSIGNATUREBLOB pSignature)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    外部使用传入的ECC公钥做签名验证</span></span><br><span class="line"><span class="comment"> *    hDev            [IN] 设备句柄</span></span><br><span class="line"><span class="comment"> *    pECCPubKeyBlob    [IN] ECC公钥数据结构</span></span><br><span class="line"><span class="comment"> *    pbData            [IN] 待验证数据</span></span><br><span class="line"><span class="comment"> *    ulDataLen        [IN] 待验证数据的长度</span></span><br><span class="line"><span class="comment"> *    pbSignature        [OUT] 签名值</span></span><br><span class="line"><span class="comment"> *    ulSignLen        [OUT] 签名值的长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ExtECCVerify</span> <span class="params">(DEVHANDLE hDev, ECCPUBLICKEYBLOB*  pECCPubKeyBlob,BYTE* pbData, ULONG ulDataLen, PECCSIGNATUREBLOB pSignature)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    使用ECC密钥协商算法，为计算会话密钥而产生协商参数，返回临时ECC密钥对的公钥及协商句柄</span></span><br><span class="line"><span class="comment"> *    hContainer        [IN] 容器句柄</span></span><br><span class="line"><span class="comment"> *    ulAlgId            [IN] 会话密钥算法标识</span></span><br><span class="line"><span class="comment"> *    pTempECCPubKeyBlob    [OUT] 发起方临时ECC公钥</span></span><br><span class="line"><span class="comment"> *    pbID            [IN] 发起方的ID</span></span><br><span class="line"><span class="comment"> *    ulIDLen            [IN] 发起方ID的长度，不大于32</span></span><br><span class="line"><span class="comment"> *    phAgreementHandle    [OUT] 返回的密钥协商句柄</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_GenerateAgreementDataWithECC</span> <span class="params">(HCONTAINER hContainer, ULONG ulAlgId,ECCPUBLICKEYBLOB*  pTempECCPubKeyBlob,BYTE* pbID, ULONG ulIDLen,HANDLE *phAgreementHandle)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    使用ECC密钥协商算法，产生协商参数并计算会话密钥，输出临时ECC密钥对公钥，并返回产生的密钥句柄</span></span><br><span class="line"><span class="comment"> *    hContainer                    [IN] 容器句柄</span></span><br><span class="line"><span class="comment"> *    ulAlgId                        [IN] 会话密钥算法标识</span></span><br><span class="line"><span class="comment"> *    pSponsorECCPubKeyBlob        [IN] 发起方的ECC公钥</span></span><br><span class="line"><span class="comment"> *    pSponsorTempECCPubKeyBlob    [IN] 发起方的临时ECC公钥</span></span><br><span class="line"><span class="comment"> *    pTempECCPubKeyBlob            [OUT] 响应方的临时ECC公钥</span></span><br><span class="line"><span class="comment"> *    pbID                        [IN] 响应方的ID</span></span><br><span class="line"><span class="comment"> *    ulIDLen                        [IN] 响应方ID的长度，不大于32</span></span><br><span class="line"><span class="comment"> *    pbSponsorID                    [IN] 发起方的ID</span></span><br><span class="line"><span class="comment"> *    ulSponsorIDLen                [IN] 发起方ID的长度，不大于32</span></span><br><span class="line"><span class="comment"> *    phKeyHandle                    [OUT] 返回的对称算法密钥句柄</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_GenerateAgreementDataAndKeyWithECC</span><span class="params">(</span></span><br><span class="line"><span class="params">                                                    HANDLE hContainer, ULONG ulAlgId,</span></span><br><span class="line"><span class="params">                                                    ECCPUBLICKEYBLOB*  pSponsorECCPubKeyBlob,</span></span><br><span class="line"><span class="params">                                                    ECCPUBLICKEYBLOB*  pSponsorTempECCPubKeyBlob,</span></span><br><span class="line"><span class="params">                                                    ECCPUBLICKEYBLOB*  pTempECCPubKeyBlob,</span></span><br><span class="line"><span class="params">                                                    BYTE* pbID, ULONG ulIDLen, BYTE *pbSponsorID, ULONG ulSponsorIDLen,</span></span><br><span class="line"><span class="params">                                                    HANDLE *phKeyHandle)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    使用ECC密钥协商算法，使用自身协商句柄和响应方的协商参数计算会话密钥，同时返回会话密钥句柄</span></span><br><span class="line"><span class="comment"> *    hAgreementHandle            [IN] 密钥协商句柄</span></span><br><span class="line"><span class="comment"> *    pECCPubKeyBlob                [IN] 外部输入的响应方ECC公钥</span></span><br><span class="line"><span class="comment"> *    pTempECCPubKeyBlob            [IN] 外部输入的响应方临时ECC公钥</span></span><br><span class="line"><span class="comment"> *    pbID                        [IN] 响应方的ID</span></span><br><span class="line"><span class="comment"> *    ulIDLen                        [IN] 响应方ID的长度，不大于32</span></span><br><span class="line"><span class="comment"> *    phKeyHandle                    [OUT] 返回的密钥句柄</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_GenerateKeyWithECC</span> <span class="params">(HANDLE hAgreementHandle,</span></span><br><span class="line"><span class="params">                                     ECCPUBLICKEYBLOB*  pECCPubKeyBlob,</span></span><br><span class="line"><span class="params">                                     ECCPUBLICKEYBLOB*  pTempECCPubKeyBlob,</span></span><br><span class="line"><span class="params">                                     BYTE* pbID, ULONG ulIDLen, HANDLE *phKeyHandle)</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    导出容器中的签名公钥或者加密公钥</span></span><br><span class="line"><span class="comment"> *    hContainer        [IN] 容器句柄</span></span><br><span class="line"><span class="comment"> *    bSignFlag        [IN] TRUE表示导出签名公钥，FALSE表示导出加密公钥</span></span><br><span class="line"><span class="comment"> *    pbBlob            [OUT] 指向RSA公钥结构（RSAPUBLICKEYBLOB）或者ECC公钥结构（ECCPUBLICKEYBLOB），如果此参数为NULL时，由pulBlobLen返回pbBlob的长度</span></span><br><span class="line"><span class="comment"> *    pulBlobLen        [IN,OUT] 调用时表示pbBlob的长度，返回导出公钥结构的大小</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ExportPublicKey</span> <span class="params">(HCONTAINER hContainer, BOOL bSignFlag, BYTE* pbBlob, ULONG* pulBlobLen)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    导入会话密钥</span></span><br><span class="line"><span class="comment"> *    hContainer        [IN] 容器句柄</span></span><br><span class="line"><span class="comment"> *    ulAlgID            [IN] 会话密钥的算法标识</span></span><br><span class="line"><span class="comment"> *    pbWrapedData    [IN] 要导入的数据</span></span><br><span class="line"><span class="comment"> *    ulWrapedLen        [IN] 数据长度</span></span><br><span class="line"><span class="comment"> *    phKey            [OUT] 返回会话密钥句柄</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_ImportSessionKey</span> <span class="params">(HCONTAINER hContainer, ULONG ulAlgId,BYTE *pbWrapedData,ULONG ulWrapedLen,HANDLE *phKey)</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    设置明文对称密钥，返回密钥句柄</span></span><br><span class="line"><span class="comment"> *    hContainer        [IN] 容器句柄</span></span><br><span class="line"><span class="comment"> *    pbKey            [IN] 指向会话密钥值的缓冲区</span></span><br><span class="line"><span class="comment"> *    ulAlgID            [IN] 会话密钥的算法标识</span></span><br><span class="line"><span class="comment"> *    phKey            [OUT] 返回会话密钥句柄</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_SetSymmKey</span> <span class="params">(DEVHANDLE hDev, BYTE* pbKey, ULONG ulAlgID, HANDLE* phKey)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    数据加密初始化。设置数据加密的算法相关参数。</span></span><br><span class="line"><span class="comment"> *    hKey            [IN] 加密密钥句柄</span></span><br><span class="line"><span class="comment"> *    EncryptParam    [IN] 分组密码算法相关参数：算法标识号、密钥长度、初始向量、初始向量长度、填充方法、加密模式、反馈值的位长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_EncryptInit</span> <span class="params">(HANDLE hKey, BLOCKCIPHERPARAM EncryptParam)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    单一分组数据的加密操作。</span></span><br><span class="line"><span class="comment">    用指定加密密钥对指定数据进行加密，被加密的数据只包含一个分组，加密后的密文保存到指定的缓冲区中。</span></span><br><span class="line"><span class="comment">    SKF_Encrypt只对单个分组数据进行加密，在调用SKF_Encrypt之前，必须调用SKF_EncryptInit初始化加密操作。</span></span><br><span class="line"><span class="comment">    SKF_Encypt等价于先调用SKF_EncryptUpdate再调用SKF_EncryptFinal。</span></span><br><span class="line"><span class="comment"> *    hKey            [IN] 加密密钥句柄</span></span><br><span class="line"><span class="comment"> *    pbData            [IN] 待加密数据</span></span><br><span class="line"><span class="comment"> *    ulDataLen        [IN] 待加密数据长度</span></span><br><span class="line"><span class="comment"> *    pbEncryptedData [OUT] 加密后的数据缓冲区指针</span></span><br><span class="line"><span class="comment"> *    pulEncryptedLen [IN,OUT] 输入，给出的缓冲区大小；输出，返回加密后的数据</span></span><br><span class="line"><span class="comment">长度</span></span><br><span class="line"><span class="comment"> *    成功: SAR_OK</span></span><br><span class="line"><span class="comment"> *    失败: SAR_FAIL SAR_MEMORYERR SAR_UNKNOWNERR  SAR_INVALIDPARAMERR SAR_BUFFER_TOO_SMALL  </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_Encrypt</span><span class="params">(HANDLE hKey, BYTE * pbData, ULONG ulDataLen, BYTE *pbEncryptedData, ULONG *pulEncryptedLen)</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    多个分组数据的加密操作。</span></span><br><span class="line"><span class="comment">    用指定加密密钥对指定数据进行加密，被加密的数据包含多个分组，加密后的密文保存到指定的缓冲区中。</span></span><br><span class="line"><span class="comment">    SKF_EncryptUpdate对多个分组数据进行加密，在调用SKF_EncryptUpdate之前，必须调用SKF_EncryptInit初始化加密操作；</span></span><br><span class="line"><span class="comment">    在调用SKF_EncryptUpdate之后，必须调用SKF_EncryptFinal结束加密操作。</span></span><br><span class="line"><span class="comment"> *    hKey            [IN] 加密密钥句柄</span></span><br><span class="line"><span class="comment"> *    pbData            [IN] 待加密数据</span></span><br><span class="line"><span class="comment"> *    ulDataLen        [IN] 待加密数据长度</span></span><br><span class="line"><span class="comment"> *    pbEncryptedData [OUT] 加密后的数据缓冲区指针</span></span><br><span class="line"><span class="comment"> *    pulEncryptedLen [OUT] 返回加密后的数据长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_EncryptUpdate</span><span class="params">(HANDLE hKey, BYTE * pbData, ULONG ulDataLen, BYTE *pbEncryptedData, ULONG *pulEncryptedLen)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    结束多个分组数据的加密，返回剩余加密结果。</span></span><br><span class="line"><span class="comment">    先调用SKF_EncryptInit初始化加密操作，</span></span><br><span class="line"><span class="comment">    再调用SKF_EncryptUpdate对多个分组数据进行加密，</span></span><br><span class="line"><span class="comment">    最后调用SKF_EncryptFinal结束多个分组数据的加密。</span></span><br><span class="line"><span class="comment"> *    hKey            [IN] 加密密钥句柄</span></span><br><span class="line"><span class="comment"> *    pbEncryptedData [OUT] 加密结果的缓冲区</span></span><br><span class="line"><span class="comment"> *    pulEncryptedLen [OUT] 加密结果的长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_EncryptFinal</span> <span class="params">(HANDLE hKey, BYTE *pbEncryptedData, ULONG *ulEncryptedDataLen )</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    数据解密初始化，设置解密密钥相关参数。</span></span><br><span class="line"><span class="comment">    调用SKF_DecryptInit之后，可以调用SKF_Decrypt对单个分组数据进行解密，</span></span><br><span class="line"><span class="comment">    也可以多次调用SKF_DecryptUpdate之后再调用SKF_DecryptFinal完成对多个分组数据的解密。</span></span><br><span class="line"><span class="comment"> *    hKey [IN] 解密密钥句柄</span></span><br><span class="line"><span class="comment"> *    DecryptParam [IN] 分组密码算法相关参数：算法标识号、密钥长度、初始向量、初始向量长度、填充方法、加密模式、反馈值的位长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_DecryptInit</span> <span class="params">(HANDLE hKey, BLOCKCIPHERPARAM DecryptParam)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    单个分组数据的解密操作</span></span><br><span class="line"><span class="comment">    用指定解密密钥对指定数据进行解密，被解密的数据只包含一个分组，解密后的明文保存到指定的缓冲区中</span></span><br><span class="line"><span class="comment">    SKF_Decrypt只对单个分组数据进行解密，在调用SKF_Decrypt之前，必须调用SKF_DecryptInit初始化解密操作</span></span><br><span class="line"><span class="comment">    SKF_Decypt等价于先调用SKF_DecryptUpdate再调用SKF_DecryptFinal</span></span><br><span class="line"><span class="comment"> *    hKey            [IN] 解密密钥句柄</span></span><br><span class="line"><span class="comment"> *    pbEncryptedData [IN] 待解密数据</span></span><br><span class="line"><span class="comment"> *    ulEncryptedLen    [IN] 待解密数据长度</span></span><br><span class="line"><span class="comment"> *    pbData            [OUT] 指向解密后的数据缓冲区指针，当为NULL时可获得解密后的数据长度</span></span><br><span class="line"><span class="comment"> *    pulDataLen        [IN，OUT] 返回解密后的数据长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_Decrypt</span><span class="params">(HANDLE hKey, BYTE * pbEncryptedData, ULONG ulEncryptedLen, BYTE * pbData, ULONG * pulDataLen)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*    多个分组数据的解密操作。</span></span><br><span class="line"><span class="comment">    用指定解密密钥对指定数据进行解密，被解密的数据包含多个分组，解密后的明文保存到指定的缓冲区中。</span></span><br><span class="line"><span class="comment">    SKF_DecryptUpdate对多个分组数据进行解密，在调用SKF_DecryptUpdate之前，必须调用SKF_DecryptInit初始化解密操作；</span></span><br><span class="line"><span class="comment">    在调用SKF_DecryptUpdate之后，必须调用SKF_DecryptFinal结束解密操作。</span></span><br><span class="line"><span class="comment"> *    hKey            [IN] 解密密钥句柄</span></span><br><span class="line"><span class="comment"> *    pbEncryptedData [IN] 待解密数据</span></span><br><span class="line"><span class="comment"> *    ulEncryptedLen    [IN] 待解密数据长度</span></span><br><span class="line"><span class="comment"> *    pbData            [OUT] 指向解密后的数据缓冲区指针</span></span><br><span class="line"><span class="comment"> *    pulDataLen        [IN，OUT] 返回解密后的数据长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_DecryptUpdate</span><span class="params">(HANDLE hKey, BYTE * pbEncryptedData, ULONG ulEncryptedLen, BYTE * pbData, ULONG * pulDataLen)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    结束多个分组数据的解密。</span></span><br><span class="line"><span class="comment"> *    hKey                [IN] 解密密钥句柄</span></span><br><span class="line"><span class="comment"> *    pbPlainText            [OUT] 指向解密结果的缓冲区，如果此参数为NULL时，由pulPlainTextLen返回解密结果的长度</span></span><br><span class="line"><span class="comment"> *    pulDecyptedDataLen    [IN，OUT] 调用时表示pbPlainText缓冲区的长度，返回解密结果的长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_DecryptFinal</span> <span class="params">(HANDLE hKey, BYTE *pbDecryptedData, ULONG *pulDecryptedDataLen)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    初始化消息杂凑计算操作，指定计算消息杂凑的算法。</span></span><br><span class="line"><span class="comment"> *    hDev            [IN] 连接设备时返回的设备句柄</span></span><br><span class="line"><span class="comment"> *    ulAlgID            [IN] 杂凑算法标识</span></span><br><span class="line"><span class="comment"> *    phHash            [OUT] 杂凑对象句柄</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_DigestInit</span><span class="params">(DEVHANDLE hDev, ULONG ulAlgID,  ECCPUBLICKEYBLOB *pPubKey, <span class="type">unsigned</span> <span class="type">char</span> *pucID, ULONG ulIDLen, HANDLE *phHash)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    对单一分组的消息进行杂凑计算。</span></span><br><span class="line"><span class="comment"> *    hHash            [IN] 杂凑对象句柄</span></span><br><span class="line"><span class="comment"> *    pbData            [IN] 指向消息数据的缓冲区</span></span><br><span class="line"><span class="comment"> *    ulDataLen        [IN] 消息数据的长度</span></span><br><span class="line"><span class="comment"> *    pbHashData        [OUT] 杂凑数据缓冲区指针，当此参数为NULL时，由pulHashLen返回杂凑结果的长度</span></span><br><span class="line"><span class="comment"> *    pulHashLen        [IN，OUT] 调用时表示pbHashData缓冲区的长度，返回杂凑结果的长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_Digest</span> <span class="params">(HANDLE hHash, BYTE *pbData, ULONG ulDataLen, BYTE *pbHashData, ULONG *pulHashLen)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    对多个分组的消息进行杂凑计算。</span></span><br><span class="line"><span class="comment"> *    hHash            [IN] 杂凑对象句柄</span></span><br><span class="line"><span class="comment"> *    pbPart            [IN] 指向消息数据的缓冲区</span></span><br><span class="line"><span class="comment"> *    ulPartLen        [IN] 消息数据的长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_DigestUpdate</span> <span class="params">(HANDLE hHash, BYTE *pbData, ULONG  ulDataLen)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    结束多个分组消息的杂凑计算操作，将杂凑保存到指定的缓冲区。</span></span><br><span class="line"><span class="comment"> *    hHash            [IN] 哈希对象句柄</span></span><br><span class="line"><span class="comment"> *    pHashData        [OUT] 返回的杂凑数据缓冲区指针，如果此参数NULL时，由pulHashLen返回杂凑结果的长度</span></span><br><span class="line"><span class="comment"> *    pulHashLen        [IN，OUT] 调用时表示杂凑结果的长度，返回杂凑数据的长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_DigestFinal</span> <span class="params">(HANDLE hHash, BYTE *pHashData, ULONG  *pulHashLen)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    初始化消息认证码计算操作，设置计算消息认证码的密钥参数，并返回消息认证码句柄。</span></span><br><span class="line"><span class="comment"> *    hKey            [IN] 计算消息认证码的密钥句柄</span></span><br><span class="line"><span class="comment"> *    MacParam        [IN] 消息认证计算相关参数，包括初始向量、初始向量长度、填充方法等</span></span><br><span class="line"><span class="comment"> *    phMac            [OUT] 消息认证码对象句柄</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_MacInit</span> <span class="params">(HANDLE hKey, BLOCKCIPHERPARAM* pMacParam, HANDLE *phMac)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    SKF_Mac计算单一分组数据的消息认证码。</span></span><br><span class="line"><span class="comment"> *    hMac            [IN] 消息认证码句柄</span></span><br><span class="line"><span class="comment"> *    pbData            [IN] 指向待计算数据的缓冲区</span></span><br><span class="line"><span class="comment"> *    ulDataLen        [IN] 待计算数据的长度</span></span><br><span class="line"><span class="comment"> *    pbMacData        [OUT] 指向计算后的Mac结果，如果此参数为NULL时，由pulMacLen返回计算后Mac结果的长度</span></span><br><span class="line"><span class="comment"> *    pulMacLen        [IN，OUT] 调用时表示pbMacData缓冲区的长度，返回计算Mac结果的长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_Mac</span><span class="params">(HANDLE hMac, BYTE* pbData, ULONG ulDataLen, BYTE *pbMacData, ULONG *pulMacLen)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    计算多个分组数据的消息认证码。</span></span><br><span class="line"><span class="comment"> *    hMac            [IN] 消息认证码句柄</span></span><br><span class="line"><span class="comment"> *    pbData            [IN] 指向待计算数据的缓冲区</span></span><br><span class="line"><span class="comment"> *    plDataLen        [IN] 待计算数据的长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_MacUpdate</span><span class="params">(HANDLE hMac, BYTE * pbData, ULONG ulDataLen)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    结束多个分组数据的消息认证码计算操作</span></span><br><span class="line"><span class="comment"> *    hMac            [IN] 消息认证码句柄</span></span><br><span class="line"><span class="comment"> *    pbMacData        [OUT] 指向消息认证码的缓冲区，当此参数为NULL时，由pulMacDataLen返回消息认证码返回的长度</span></span><br><span class="line"><span class="comment"> *    pulMacDataLen    [OUT] 调用时表示消息认证码缓冲区的最大长度，返回消息认证码的长度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_MacFinal</span> <span class="params">(HANDLE hMac, BYTE *pbMacData, ULONG *pulMacDataLen)</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *    关闭会话密钥、杂凑、消息认证码句柄。</span></span><br><span class="line"><span class="comment"> *    hHandle            [IN] 要关闭的对象句柄</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_CloseHandle</span><span class="params">(HANDLE hHandle)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// *    获取ECC的Z值</span></span><br><span class="line"><span class="comment">// *    hDev            [IN] 设备句柄</span></span><br><span class="line"><span class="comment">// *    pECCPubKeyBlob    [IN] ECC公钥数据结构</span></span><br><span class="line"><span class="comment">// *    pUserID            [IN] 用户ID</span></span><br><span class="line"><span class="comment">//  *    iUserIDLen        [IN] 用户ID长度</span></span><br><span class="line"><span class="comment">// *    pDataOut        [OUT] 指向Z值的缓冲区</span></span><br><span class="line"><span class="comment">//  *    piDataOutLen    [IN,OUT] 调用时表示pDataOut的长度，返回Z值的大小</span></span><br><span class="line"><span class="comment">//  UID使用默认的 &quot;1234567812345678&quot; ULONG DEVAPI SKF_ECCGetZ(IN DEVHANDLE hDev,</span></span><br><span class="line"><span class="comment">//       IN ECCPUBLICKEYBLOB* pECCPubKeyBlob,</span></span><br><span class="line"><span class="comment">//       IN BYTE *pUserID,</span></span><br><span class="line"><span class="comment">//       IN ULONG iUserIDLen,</span></span><br><span class="line"><span class="comment">//       OUT BYTE *pDataOut,</span></span><br><span class="line"><span class="comment">//       IN OUT ULONG *piDataOutLen);</span></span><br><span class="line"><span class="comment">// //////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">// //</span></span><br><span class="line"><span class="comment">// ULONG DEVAPI SKF_Format(DEVHANDLE hDev, char *szSOPin, DWORD dwSOPinMaxRetryCount,</span></span><br><span class="line"><span class="comment">//                         char *szUserPin, DWORD dwUserPinMaxRetryCount,</span></span><br><span class="line"><span class="comment">//                         char *szApplicateName, char * szLabel);</span></span><br><span class="line"> </span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_Transmit</span><span class="params">(DEVHANDLE hDev, BYTE* pbCommand, ULONG ulCommandLen,BYTE* pbData, ULONG* pulDataLen)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* 指纹验证-- 验证指纹时使用</span></span><br><span class="line"><span class="comment"> * hApplication  [IN] 应用句柄</span></span><br><span class="line"><span class="comment"> * ulPinType     [IN] 0：管理员1：用户</span></span><br><span class="line"><span class="comment"> * ulRetryCount  [IN] 重新次数</span></span><br><span class="line"><span class="comment">* ulPopFingerUI [IN] 是否弹出指纹框0：不弹出1：弹出</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_VerifyFinger</span><span class="params">(HAPPLICATION hApplication, ULONG  ulPINType, LPSTR szPIN, ULONG *pulRetryCount)</span>;</span><br><span class="line"><span class="comment">//ULONG DEVAPI SKF_VerifyFinger(IN HAPPLICATION hApplication,IN ULONG ulPINType,IN ULONG ulRetryCount,IN ULONG ulPopFingerUI);</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*  指纹测试- 测试当前指纹ID -- 用于指纹测试需要用户、管理员权限，管理员指纹只能在管理员权限下测试， 用户指纹可在用户或管理员权限下测试。</span></span><br><span class="line"><span class="comment">* hApplication [IN] 应用句柄</span></span><br><span class="line"><span class="comment">* ulPinType    [IN] 0：管理员 1：用户</span></span><br><span class="line"><span class="comment">* pulFingerId  [OUT] 指纹ID</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_TestFinger</span><span class="params">(HAPPLICATION hApplication,ULONG ulPINType,ULONG * pulFingerId)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 验证指定指纹ID</span></span><br><span class="line"><span class="comment">* hApplication [IN] 应用句柄</span></span><br><span class="line"><span class="comment"> * ulPinType    [IN] 0：管理员 1：用户</span></span><br><span class="line"><span class="comment"> * ulRetryCount  [IN] 重试次数</span></span><br><span class="line"><span class="comment"> * ulFingerId  [IN] 指纹ID</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ULONG DEVAPI <span class="title function_">SKF_VerifyFingerById</span><span class="params">(IN HAPPLICATION hApplication,IN ULONG ulPINType,IN ULONG ulRetryCount,IN ULONG ulFingerId)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//深圳ca扩展接口</span></span><br><span class="line"><span class="comment">/* RSA私钥解密</span></span><br><span class="line"><span class="comment">* 使用指定容器内的RSA私钥对输入数据解密运算并输出结果</span></span><br><span class="line"><span class="comment"> * hContainer   [IN] 容器句柄</span></span><br><span class="line"><span class="comment"> * bSignFlag    [IN] false -- 加密私钥  true -- 签名私钥</span></span><br><span class="line"><span class="comment"> * pbInput      [IN] 指向待运算的原始数据缓冲区</span></span><br><span class="line"><span class="comment"> * ulInputLen   [IN] 待运算原始数据的长度，必须为公钥模长</span></span><br><span class="line"><span class="comment"> * pbOutput     [OUT] 指向RSA私钥运算结果缓冲区，如果该参数为NULL，则由pulOutputLen返回运算结果的实际长度</span></span><br><span class="line"><span class="comment">* pulOutputLen [in, OUT] 调用前表示pbOutput缓冲区的长度，返回RSA私钥运算结果的实际长度</span></span><br><span class="line"><span class="comment">返回值：0：成功 其它：错误码</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">SKF_ULONG DEVAPI <span class="title function_">SKF_RSADecrypt</span><span class="params">(HCONTAINER hContainer, BYTE bSignFlag, BYTE * pbInput, SKF_ULONG ulInputLen, BYTE * pbOutput, SKF_ULONG * pulOutputLen)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* ECC私钥解密</span></span><br><span class="line"><span class="comment"> * hContainer  [IN] 容器句柄</span></span><br><span class="line"><span class="comment"> * bSignFlag   [IN] false -- 加密私钥  true -- 签名私钥</span></span><br><span class="line"><span class="comment">* pCipherText [IN] 加密数据结构</span></span><br><span class="line"><span class="comment"> * pbData      [OUT] 指向解密结果的缓冲区,如果值为NULL，用于取得解密后数据长度</span></span><br><span class="line"><span class="comment"> * pbDataLen   [OUT] 调用时表示pbData的长度，返回解密数据的大小</span></span><br><span class="line"><span class="comment">返回值：0：成功 其它：错误码</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">SKF_ULONG DEVAPI <span class="title function_">SKF_ECCDecrypt</span><span class="params">(HCONTAINER hContainer,BYTE bSignFlag, PECCCIPHERBLOB pCipherText, BYTE * pbData, SKF_ULONG * pbDataLen)</span>;</span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<h1 id="SKF-接口调用"><a href="#SKF-接口调用" class="headerlink" title="SKF 接口调用"></a>SKF 接口调用</h1><h2 id="获取所有的国密证书"><a href="#获取所有的国密证书" class="headerlink" title="获取所有的国密证书"></a>获取所有的国密证书</h2><p>根据国密标准，一种设备类型可以有多个设备（Device），每一个设备内可以有多个应用（Application），每一个应用里可以有多个容器（Container），每个容器里可以有一对证书（Certificate）：签名证书和加密证书。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取证书的流程如下</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 遍历当前电脑上的设备</span></span><br><span class="line"><span class="comment">    * 按照惯例，这个方法应该被调用两次：</span></span><br><span class="line"><span class="comment">    * 第一次szNameList传NULL，pulSize返回长度；</span></span><br><span class="line"><span class="comment">    * 第二次给szNameList分配pulSize长度，返回设备列表，每个设备的名称以单个’\0’结束，以双’\0’表示列表的结束</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    SKF_EnumDev(BOOL bPresent, LPSTR szNameList, ULONG *pulSize);  <span class="comment">//得到设备名列表</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">/*通过szName，连接设备*/</span></span><br><span class="line">    SKF_ConnectDev(LPSTR szName, DEVHANDLE *phDev);                  <span class="comment">//得到设备句柄</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">/*遍历设备里的应用列表， 按照惯例，这个方法应该被调用两次*/</span></span><br><span class="line">    SKF_EnumApplication(DEVHANDLE hDev, LPSTR szAppNameList,ULONG *pulSize); <span class="comment">//得到应用名称列表</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">/*打开应用*/</span></span><br><span class="line">    SKF_OpenApplication(DEVHANDLE hDev, LPSTR szAppName, HAPPLICATION *phApplication); <span class="comment">//得到应用句柄</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">/*遍历容器*/</span></span><br><span class="line">    SKF_EnumContainer(IN HAPPLICATIONhApplication, OUT LPSTRszContainerNameList, OUT ULONG*pulSize);  <span class="comment">//得到容器名称列表</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">/*打开容器*/</span></span><br><span class="line">    SKF_OpenContainer(HAPPLICATION hApplication,LPSTR szContainerName,HCONTAINER *phContainer); <span class="comment">//得到容器句柄</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">/*导出证书*/</span></span><br><span class="line">    SKF_ExportCertificate(HCONTAINER hContainer, BOOL bSignFlag, BYTE* pbCert, ULONG *pulCertLen); <span class="comment">//得到证书</span></span><br><span class="line"> </span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h2 id="数字签名"><a href="#数字签名" class="headerlink" title="数字签名"></a>数字签名</h2><p>在数字签名时，要指定签名所使用的证书。</p>
<p>通过遍历本机上的证书，与签名用的证书进行对比，定位到签名证书在USBKEY中的位置，得到设备、应用和容器的句柄，然后使用证书的私钥进行签名。另外,由于数字签名会用到私钥，因此这里需要验证口令。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//签名的流程</span></span><br><span class="line">    <span class="comment">/*验证证书所在应用的PIN*/</span></span><br><span class="line">    SKF_VerifyPIN(HAPPLICATION hApplication, ULONG ulPINType, LPSTR szPIN, ULONG *pulRetryCount);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 导出容器中的签名公钥</span></span><br><span class="line"><span class="comment">    * 这里这个方法可以不用调用两次，因为公钥结构是已知的，其长度也是固定的，因此可以直接为pbBlob分配固定长度的数据，以返回公钥</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    SKF_ExportPublicKey(HCONTAINER hContainer, BOOL bSignFlag, BYTE* pbBlob, ULONG* pulBlobLen);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 进行杂凑(摘要)运算初始化</span></span><br><span class="line"><span class="comment">     * pucID为签名者的ID值，加入签名者ID值是SM2数字签名的一个重要特征</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SKF_DigestInit(DEVHANDLE hDev, ULONG ulAlgID, ECCPUBLICKEYBLOB *pPubKey, <span class="type">unsigned</span> <span class="type">char</span> *pucID, ULONG ulIDLen, HANDLE *phHash);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/*进行杂凑运算*/</span></span><br><span class="line">    SKF_Digest(HANDLE hHash, BYTE *pbData, ULONG ulDataLen, BYTE *pbHashData, ULONG *pulHashLen);</span><br><span class="line">    <span class="comment">//如果进行杂凑的数据是分组的，那就得使用下面两个方法：</span></span><br><span class="line">    <span class="comment">//当然，在数字签名运算中不存在分块计算签名的情况，所以这里也不会把数据分块杂凑</span></span><br><span class="line">    SKF_DigestUpdate(HANDLE hHash, BYTE *pbData, ULONG ulDataLen);</span><br><span class="line">    SKF_DigestFinal(HANDLE hHash, BYTE *pHashData, ULONG *pulHashLen);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/*进行数字签名*/</span></span><br><span class="line">    SKF_ECCSignData(HCONTAINER hContainer, BYTE *pbData, ULONG ulDataLen, PECCSIGNATUREBLOB pSignature);</span><br><span class="line"> </span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h2 id="验证签名"><a href="#验证签名" class="headerlink" title="验证签名"></a>验证签名</h2><p>使用SKF验签的流程:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//验签的流程</span></span><br><span class="line">    <span class="comment">//创建一个临时容器</span></span><br><span class="line">    SKF_CreateContainer(HAPPLICATION hApplication, LPSTR szContainerName, HCONTAINER *phContainer);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//将签名用的证书导入容器</span></span><br><span class="line">    SKF_ImportCertificate(HCONTAINER hContainer, BOOL bSignFlag, BYTE* pbCert, ULONG ulCertLen);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//导出公钥</span></span><br><span class="line">    SKF_ExportPublicKey(HCONTAINER hContainer, BOOL bSignFlag, BYTE* pbBlob, ULONG* pulBlobLen);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//杂凑初始化</span></span><br><span class="line">    SKF_Digest(HANDLE hHash, BYTE *pbData, ULONG ulDataLen, BYTE *pbHashData, ULONG *pulHashLen);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//杂凑运算</span></span><br><span class="line">    SKF_Digest(HANDLE hHash, BYTE *pbData, ULONG ulDataLen, BYTE *pbHashData, ULONG *pulHashLen);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//签名验证</span></span><br><span class="line">    SKF_ECCVerify(DEVHANDLE hDev , ECCPUBLICKEYBLOB* pECCPubKeyBlob, BYTE *pbData, ULONG ulDataLen, PECCSIGNATUREBLOB pSignature);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//删除临时容器</span></span><br><span class="line">    SKF_DeleteContainer(HAPPLICATION hApplication, LPSTR szContainerName);</span><br></pre></td></tr></table></figure>



<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><blockquote>
<p>  <a target="_blank" rel="noopener" href="http://gmssl.org/docs/skf.html">http://gmssl.org/docs/skf.html</a></p>
<p>  <a target="_blank" rel="noopener" href="https://blog.csdn.net/answer966480/article/details/107187168">https://blog.csdn.net/answer966480/article/details/107187168</a></p>
<p>  <a target="_blank" rel="noopener" href="https://github.com/guanzhi/GM-Standards/tree/master/GMT%E6%AD%A3%E5%BC%8F%E6%A0%87%E5%87%86">https://github.com/guanzhi/GM-Standards/tree/master/GMT%E6%AD%A3%E5%BC%8F%E6%A0%87%E5%87%86</a></p>
</blockquote>
</div><div class="tags"><a href="/tags/gm/"><i class="fa fa-tag"></i>gm</a></div><div class="post-nav"><a class="pre" href="/article/27604/">硬件学习笔记-USB接口</a><a class="next" href="/article/25197/">国密学习笔记-专业术语</a></div><script src="https://utteranc.es/client.js" repo="echomlv/blog_comments" issue-term="title" theme="github-light" crossorigin="anonymous" async> </script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar-toc"><div class="stoc-article" id="sidebar-stoc"><strong class="stoc-title"><i class="fa fa-blind"> Contents </i></strong><div class="toc-nav" id="stoc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SKF%E6%8E%A5%E5%8F%A3%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">SKF接口简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E5%85%B3%E7%B3%BB"><span class="toc-number">2.</span> <span class="toc-text">逻辑关系</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SKF-%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.</span> <span class="toc-text">SKF 接口</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SKF-%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8"><span class="toc-number">4.</span> <span class="toc-text">SKF 接口调用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E7%9A%84%E5%9B%BD%E5%AF%86%E8%AF%81%E4%B9%A6"><span class="toc-number">4.1.</span> <span class="toc-text">获取所有的国密证书</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D"><span class="toc-number">4.2.</span> <span class="toc-text">数字签名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%AD%BE%E5%90%8D"><span class="toc-number">4.3.</span> <span class="toc-text">验证签名</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">5.</span> <span class="toc-text">参考</span></a></li></ol></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2023 <a href="/." rel="nofollow">行走的康康.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" color="246,246,246" opacity="0.5" zIndex="-2" count="50" src="//cdn.jsdelivr.net/npm/canvas-nest.js/dist/canvas-nest.min.js"></script><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>